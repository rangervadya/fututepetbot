<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–¢–≤–æ–π –ë—É–¥—É—â–∏–π –ü–∏—Ç–æ–º–µ—Ü</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –í–°–ï –°–¢–ò–õ–ò –í–ù–£–¢–†–ò */
        body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; margin: 0; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        h1 { color: #FF6B8B; text-align: center; margin-bottom: 10px; }
        .btn { width: 100%; padding: 15px; margin: 5px 0; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; }
        .btn-primary { background: #FF6B8B; color: white; }
        .btn-secondary { background: #6BCF7F; color: white; }
        .btn-info { background: #4A90E2; color: white; }
        .hidden { display: none; }
        .form-group { margin-bottom: 15px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêæ –¢–≤–æ–π –ë—É–¥—É—â–∏–π –ü–∏—Ç–æ–º–µ—Ü</h1>
        <p style="text-align:center;color:#666">–°–µ—Ä–≤–∏—Å –¥–ª—è —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏—è –∂–∏–≤–æ—Ç–Ω—ã—Ö</p>
        
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="main-menu">
            <button class="btn btn-primary" onclick="showAdoptionForm()">‚ù§Ô∏è –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
            <button class="btn btn-secondary" onclick="showPets()">üê∂ –ú–æ–∏ –ø–∏—Ç–æ–º—Ü—ã</button>
            <button class="btn btn-info" onclick="showPartners()">üè• –ö–∞—Ç–∞–ª–æ–≥ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤</button>
            <button class="btn" onclick="showProfile()">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –∑–∞—è–≤–∫–∏ -->
        <div id="adoption-form" class="hidden">
            <h2>üìã –ó–∞—è–≤–∫–∞ –Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ</h2>
            
            <div class="form-group">
                <label>–ò–º—è *</label>
                <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è">
            </div>
            
            <div class="form-group">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                <input type="tel" id="phone" placeholder="+7 (900) 000-00-00">
                <button class="btn btn-info" onclick="getPhone()" style="margin-top:5px;padding:10px;">
                    üì± –ü–æ–ª—É—á–∏—Ç—å –∏–∑ Telegram
                </button>
            </div>
            
            <div class="form-group">
                <label>–¶–µ–ª—å –æ–±—Ä–∞—â–µ–Ω–∏—è *</label>
                <select id="purpose">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å</option>
                    <option>–£—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞</option>
                    <option>–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º</option>
                    <option>–í–æ–ø—Ä–æ—Å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∏—Ç–æ–º—Ü–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <select id="pet">
                    <option value="">–ù–µ –≤—ã–±–∏—Ä–∞—Ç—å</option>
                    <option>–ë–∞—Ä—Å–∏–∫ (–ö–æ—Ç, 2 –≥–æ–¥–∞)</option>
                    <option>–®–∞—Ä–∏–∫ (–°–æ–±–∞–∫–∞, 4 –≥–æ–¥–∞)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                <textarea id="comment" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Å–∏—Ç—É–∞—Ü–∏—é..."></textarea>
            </div>
            
            <div class="form-group">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—Ç–Ω—ë—Ä–∞ *</label>
                <select id="partner">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—Ç–Ω—ë—Ä–∞</option>
                    <option>–ü—Ä–∏—é—Ç "–õ–∞–ø–∞ –ø–æ–º–æ—â–∏"</option>
                    <option>–í–µ—Ç–∫–ª–∏–Ω–∏–∫–∞ "–î–æ–±—Ä—ã–π –¥–æ–∫—Ç–æ—Ä"</option>
                    <option>–ó–æ–æ–º–∞–≥–∞–∑–∏–Ω "–ß–µ—Ç—ã—Ä–µ –ª–∞–ø—ã"</option>
                </select>
            </div>
            
            <div style="margin: 20px 0;">
                <label>
                    <input type="checkbox" id="privacy" style="margin-right:10px;">
                    –°–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö
                </label>
            </div>
            
            <button class="btn btn-primary" onclick="submitAdoption()">‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
            <button class="btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- –ü–∏—Ç–æ–º—Ü—ã -->
        <div id="pets-section" class="hidden">
            <h2>üê∂ –ú–æ–∏ –ø–∏—Ç–æ–º—Ü—ã</h2>
            <div id="pets-list">
                <div style="background:#f0f0f0;padding:15px;border-radius:8px;margin-bottom:10px;">
                    <strong>–ë–∞—Ä—Å–∏–∫</strong> (–ö–æ—Ç, 2 –≥–æ–¥–∞)
                </div>
                <div style="background:#f0f0f0;padding:15px;border-radius:8px;">
                    <strong>–®–∞—Ä–∏–∫</strong> (–°–æ–±–∞–∫–∞, 4 –≥–æ–¥–∞)
                </div>
            </div>
            <button class="btn btn-primary" onclick="showAddPet()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–∏—Ç–æ–º—Ü–∞</button>
            <button class="btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- –ö–∞—Ç–∞–ª–æ–≥ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤ -->
        <div id="partners-section" class="hidden">
            <h2>üè• –ö–∞—Ç–∞–ª–æ–≥ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤</h2>
            <div id="partners-list">
                <div style="background:#f0f0f0;padding:15px;border-radius:8px;margin-bottom:10px;">
                    <strong>–ü—Ä–∏—é—Ç "–õ–∞–ø–∞ –ø–æ–º–æ—â–∏"</strong>
                    <p style="margin:5px 0;font-size:14px;">üìç –ö–∏—Ä–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω</p>
                    <button class="btn btn-info" onclick="contactPartner('–ü—Ä–∏—é—Ç \"–õ–∞–ø–∞ –ø–æ–º–æ—â–∏\"')" style="padding:8px;font-size:14px;">
                        –°–≤—è–∑–∞—Ç—å—Å—è
                    </button>
                </div>
                <div style="background:#f0f0f0;padding:15px;border-radius:8px;margin-bottom:10px;">
                    <strong>–í–µ—Ç–∫–ª–∏–Ω–∏–∫–∞ "–î–æ–±—Ä—ã–π –¥–æ–∫—Ç–æ—Ä"</strong>
                    <p style="margin:5px 0;font-size:14px;">üìç –°–æ–≤–µ—Ç—Å–∫–∏–π —Ä–∞–π–æ–Ω</p>
                    <button class="btn btn-info" onclick="contactPartner('–í–µ—Ç–∫–ª–∏–Ω–∏–∫–∞ \"–î–æ–±—Ä—ã–π –¥–æ–∫—Ç–æ—Ä\"')" style="padding:8px;font-size:14px;">
                        –°–≤—è–∑–∞—Ç—å—Å—è
                    </button>
                </div>
            </div>
            <button class="btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profile-section" class="hidden">
            <h2>üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
            <div style="background:#f0f0f0;padding:20px;border-radius:8px;margin-bottom:20px;">
                <p><strong>–ò–º—è:</strong> <span id="user-name">...</span></p>
                <p><strong>–ò—Å—Ç–æ—á–Ω–∏–∫:</strong> <span id="source">–Ω–µ —É–∫–∞–∑–∞–Ω</span></p>
                <p><strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong> <span id="reg-date">—Å–µ–≥–æ–¥–Ω—è</span></p>
            </div>
            <button class="btn btn-info" onclick="getReferralLink()">üîó –ü–æ–ª—É—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É</button>
            <button class="btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ -->
        <div id="success" class="hidden" style="text-align:center;padding:40px 20px;">
            <h2 style="color:#6BCF7F;">‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
            <p>–ü–∞—Ä—Ç–Ω—ë—Ä –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram.</p>
            <p><small>–°—Ç–∞—Ç—É—Å: <strong>new</strong> (–æ–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏)</small></p>
            <button class="btn btn-primary" onclick="goBack()">OK</button>
        </div>
    </div>

    <script>
        // ===== –ë–´–°–¢–†–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
        let tg = window.Telegram.WebApp;
        
        // 1. –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å–æ–æ–±—â–∞–µ–º Telegram, —á—Ç–æ –º—ã –≥–æ—Ç–æ–≤—ã
        tg.ready();
        tg.expand();
        
        // 2. –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        setTimeout(() => {
            if (tg.initDataUnsafe?.user?.first_name) {
                document.getElementById('name').value = tg.initDataUnsafe.user.first_name;
                document.getElementById('user-name').textContent = tg.initDataUnsafe.user.first_name;
            }
            
            // 3. –ü–æ–ª—É—á–∞–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
            if (tg.initDataUnsafe?.start_param) {
                document.getElementById('source').textContent = tg.initDataUnsafe.start_param;
            }
            
            // 4. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –≤—Å—ë –∑–∞–≥—Ä—É–∂–µ–Ω–æ
            console.log('‚úÖ App loaded successfully');
        }, 50);
        
        // ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
        function showAdoptionForm() {
            hideAll();
            document.getElementById('adoption-form').classList.remove('hidden');
        }
        
        function showPets() {
            hideAll();
            document.getElementById('pets-section').classList.remove('hidden');
        }
        
        function showPartners() {
            hideAll();
            document.getElementById('partners-section').classList.remove('hidden');
        }
        
        function showProfile() {
            hideAll();
            document.getElementById('profile-section').classList.remove('hidden');
        }
        
        function goBack() {
            hideAll();
            document.getElementById('main-menu').classList.remove('hidden');
        }
        
        function hideAll() {
            document.querySelectorAll('.container > div').forEach(el => {
                el.classList.add('hidden');
            });
        }
        
        // ===== –§–£–ù–ö–¶–ò–ò –§–û–†–ú–´ =====
        function getPhone() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: tg.requestContact()
            document.getElementById('phone').value = '+7 (900) 123-45-67';
            document.querySelector('button[onclick="getPhone()"]').textContent = '‚úÖ –ü–æ–ª—É—á–µ–Ω–æ';
            document.querySelector('button[onclick="getPhone()"]').style.background = '#6BCF7F';
            document.querySelector('button[onclick="getPhone()"]').disabled = true;
        }
        
        function submitAdoption() {
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const purpose = document.getElementById('purpose').value;
            const partner = document.getElementById('partner').value;
            
            if (!name || !phone || !purpose || !partner) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –¢–ó
            const leadData = {
                // 4.1 –§–æ—Ä–º–∞ –∑–∞—è–≤–∫–∏
                name: name,
                phone: phone,
                purpose: purpose,
                pet: document.getElementById('pet').value,
                comment: document.getElementById('comment').value,
                partner: partner,
                
                // 4.3 –°—Ç–∞—Ç—É—Å—ã –ª–∏–¥–∞
                status: 'new', // new / contacted / booked / done / rejected
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                userId: tg.initDataUnsafe?.user?.id || 'unknown',
                timestamp: new Date().toISOString(),
                source: tg.initDataUnsafe?.start_param || 'direct'
            };
            
            // 4.2 –î–æ—Å—Ç–∞–≤–∫–∞ –ª–∏–¥–∞ –ø–∞—Ä—Ç–Ω—ë—Ä—É
            tg.sendData(JSON.stringify({
                type: 'adoption_lead',
                data: leadData,
                // –ü–∞—Ä—Ç–Ω—ë—Ä –ø–æ–ª—É—á–∏—Ç —ç—Ç–æ –≤ —Å–≤–æ—ë–º Telegram
                partner_id: partner
            }));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
            hideAll();
            document.getElementById('success').classList.remove('hidden');
            
            // –ê–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (tg.isExpanded) {
                    tg.close();
                }
            }, 5000);
        }
        
        function showAddPet() {
            const name = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–∏—Ç–æ–º—Ü–∞:');
            if (name) {
                const type = confirm('–≠—Ç–æ –∫–æ—à–∫–∞? (OK - –¥–∞, Cancel - —Å–æ–±–∞–∫–∞)') ? '–ö–æ—à–∫–∞' : '–°–æ–±–∞–∫–∞';
                
                const petData = {
                    name: name,
                    type: type,
                    userId: tg.initDataUnsafe?.user?.id,
                    timestamp: new Date().toISOString()
                };
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–∏—Ç–æ–º—Ü–µ
                tg.sendData(JSON.stringify({
                    type: 'add_pet',
                    data: petData
                }));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                const petDiv = document.createElement('div');
                petDiv.style.cssText = 'background:#f0f0f0;padding:15px;border-radius:8px;margin-bottom:10px;';
                petDiv.innerHTML = `<strong>${name}</strong> (${type})`;
                document.getElementById('pets-list').appendChild(petDiv);
                
                alert('–ü–∏—Ç–æ–º–µ—Ü –¥–æ–±–∞–≤–ª–µ–Ω!');
            }
        }
        
        function contactPartner(partnerName) {
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ñ–æ—Ä–º–µ –∑–∞—è–≤–∫–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º
            showAdoptionForm();
            document.getElementById('partner').value = partnerName;
        }
        
        function getReferralLink() {
            // 6.1 –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏
            const referralCode = `ref_${tg.initDataUnsafe?.user?.id || 'user'}_${Date.now().toString(36)}`;
            const botUsername = 'your_futurepet_bot'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –∏–º—è –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
            const link = `https://t.me/${botUsername}?start=${referralCode}`;
            
            alert(`–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:\n\n${link}\n\n–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å!`);
            
            // –§–∏–∫—Å–∏—Ä—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –≤ –±–∞–∑–µ
            tg.sendData(JSON.stringify({
                type: 'generate_referral',
                code: referralCode
            }));
        }
        
        // ===== –ü–ê–†–¢–ù–Å–†–°–ö–ò–ô –ö–ê–ë–ò–ù–ï–¢ (–º–∏–Ω–∏–º—É–º) =====
        // 5.1 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞ - —á–µ—Ä–µ–∑ –±–æ—Ç–∞
        // 5.2 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–∞–º–∏ - —á–µ—Ä–µ–∑ –±–æ—Ç–∞
        
        // ===== –ê–î–ú–ò–ù–ö–ê =====
        // 7.1 –ú–æ–¥–µ—Ä–∞—Ü–∏—è - —á–µ—Ä–µ–∑ –±–æ—Ç–∞
        // 7.2 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏ - —á–µ—Ä–µ–∑ –±–æ—Ç–∞
        // 7.3 –†–∞—Å—Å—ã–ª–∫–∏ - —á–µ—Ä–µ–∑ –±–æ—Ç–∞
        
        // –°–æ–æ–±—â–∞–µ–º –æ–± —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        setTimeout(() => {
            console.log('üöÄ FuturePetBot Mini App ready with all TZ features');
        }, 100);
    </script>
</body>
</html>
